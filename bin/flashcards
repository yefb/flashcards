#!/usr/bin/env ruby

require 'yaml'
require 'term/ansicolor'
require 'flashcards'

String.send(:include, Term::ANSIColor)

case ARGV.shift
  # flashcards add es 'Madre mia!' 'Oh my!'
when 'add', '+'
  unless ARGV.length == 3
    abort "Usage: #{$0} [lang] [word] [translation]"
  end

  load_do_then_save(ARGV[0]) do |data, lang, flashcards|
    unless flashcards.find { |flashcard| flashcard == Flashcard.new(expression: ARGV[1], translations: ARGV[2].split(',')) }
      flashcards << Flashcard.new(expression: ARGV[1], translations: ARGV[2].split(','))
      data[ARGV[0]] = flashcards.map(&:data)
    else
      warn "~ #{ARGV[1]} is already defined."
    end
  end
when 'reset'
  load_do_then_save do |data, lang, flashcards|
    data[lang] = flashcards.each { |flashcard| flashcard.metadata.clear }.map(&:data)
  end
when 'edit'
  editor = ARGV.shift || ENV['EDITOR'] || abort('Either configure $EDITOR or pass an editor as an arguement.')
  exec "#{editor} #{FLASHCARDS_DATA.path}"
when '--help', '-h'
  puts(colourise(DATA.read))
when nil
  load_do_then_save do |data, lang, flashcards|
    # Switch system language to whatever language you're learning.
    run(lang, flashcards)

    # Save metadata.
    data[lang] = flashcards.map(&:data)
  end
end

__END__

<red.bold>:: Flashcards ::</red.bold>

<cyan.bold>Commands</cyan.bold>

flashcards <red>add</red> [lang] [word] [translations]
flashcards <red>add</red> es todav√≠a still
flashcards <red>add</red> es case almost,nearly <bright_black># Add multiple translations.</bright_black>

flashcards <yellow>reset</yellow> <bright_black># Reset metadata.
  # Useful if you got someone else's file, and you want to reset his progress.</bright_black>

flashcards <green>edit</green> <bright_black># Edit your flashcards in $EDITOR.</bright_black>
flashcards <green>edit</green> vim

flashcards <bright_black># Run it!</bright_black>

<cyan.bold>ENV</cyan.bold>
  <magenta>FF</magenta>
    <bright_black># FF is short for flashcard file.
    # It defaults to ~/.config/flashcards.yml</bright_black>
    FF=~/.config/flashcards/es/swearwords.yml flashcards
